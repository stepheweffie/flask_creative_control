{% extends 'base.html' %}
{{ super() }}
{% block body %}
<div class="container-fluid welcome-message">
{{ welcome_message }}, {{ username }}
</div>
<div class="container-fluid">
<form id="chat" class="form-inline">
    <div class="row" id="draggable">
    <div class="col-sm-5">
        <input type="text" id="handle" class="text-input">
    </div>
    <div class="col-sm-5">
        <input type="text" id="chat-text" class="text-input" placeholder="Chat away...">
    </div>
    <div class="col-sm-2">
    <button type="submit" id="send">Send</button>
    </div>
    </div>
</form>
</div>

<div class="container-fluid flex-container">
<div id="chat-log" class="row">
<div id="chat-message">

</div>
</div>
</div>

 <div class="modal" id="myModal">
{% include 'modal.html' %}
 </div>


<script type="text/javascript">
$(document).onload(function () {
    $('modal')
});

$(document).ready(function(){
    if ("WebSocket in window") {
        const client = new WebSocket('wss://cc-simple-chat.herokuapp.com');
        client.onopen = function(){
        // Send a small message to the console once the connection is established */
        console.log('Connection open!');
};
    client.onclose = function(){
        console.log('Connection closed');
};
    client.onmessage = function(message) {
        const message_data = JSON.parse(message.data);
        $('#chat-message').append('<div>'+message_data.text+'</div>');

};
// server
const handle = $("#handle")[0].value;
const text = $("#chat-text")[0].value;
const message = (JSON.stringify({ handle: handle, text: text, type: message}));

$("button").click = function() {
    console.log('chatting...');
    $('.text-input')[0].value = "";
};

$("form").submit = function() {
    client.send(message);
}}})
</script>

{% endblock %}
