<!DOCTYPE html>
<html>
  <head>
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
      <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
      <link rel="stylesheet" href="{{ url_for('static'}}/css/application.css">
  </head>
<body>

<div class="container-fluid flex-container">
<div id="chat-log" class="row">
<ul>

{{ welcome_message }}

</ul>

<br>
<br>

</div>
</div>

<div class="container-fluid">
<form id="chat" class="form-inline">
    <div class="row">
    <div class="col-sm-6">
        <input type="text" id="handle" class="text-input">
    </div>
    <div class="col-sm-6">
        <input type="text" id="chat-text" class="text-input" placeholder="Chat away...">
    </div>
  </div>
    <button type="submit" id="send">Send</button>
</form>
</div>

<script>
    $('.chat').draggable({ handle: 'form' });
if ("WebSocket in window") {
    alert("WebSocket is supported by your Browser!");
    const client = new WebSocket('wss://cc-simple-chat.herokuapp.com:5000');
    client.onopen = function(){
    // Send a small message to the console once the connection is established */
    console.log('Connection open!');
};
    client.onclose = function(){
    console.log('Connection closed');
};
    client.onmessage = function(message) {
        const message_data = JSON.parse(message.data);
        ("ul").innerHTML += message_data + "<br>";
        $("#chat-log").slideUp(2000).css("").stop().animate({
        scrollTop: $('#chat-log')[0].scrollHeight
        }, 800);
};

$("button").click = function(event) {
    event.preventDefault();
    $(".text-input")[0].value = "";
};}

$("form").submit = function() {
    const handle = $("#handle")[0].value;
    const text = $("#chat-text")[0].value;
    const msg = (JSON.stringify({ handle: handle, text: text, type: message}));
    client.send(msg)
}

</script>
</body>
</html>
